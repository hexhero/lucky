<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>年会抽奖</title> 
<link rel="stylesheet" href="../static/css/demo.css"> 
<script type="text/javascript" src="../static/lib/jquery.js"></script> 
</head>
<body>
<!-- 主体盒子-->
<div class="main-box">
    <div class="main_left">
        <img src="../static/img/cj-1.png" class="main_title" />
        <div class="lb">
            <img src="../static/img/leftbt.png" id="getLeft" onclick="getLeft()" />
            <img src="../static/img/rightbt.png" id="getRight" onclick="getRight()" />
            <img src="../static/img/jpt.png"  id="showl" class="show" />
            <img src="../static/img/jp3.png"  id="show" class="show" />
            <img src="../static/img/jp2.png"  id="showr" class="show" />
        </div>
        <div class="cjrs">
            抽奖人数 <input value="" type="text" id="num" /> 人
        </div>
        <img class="cjbt" id="start_bt"  src="../static/img/btns.png" onclick="cjDo()" />
        <img class="cjbt" id="end_bt" src="../static/img/btns_end.png" onclick="cjStop()" style=" display:none" />
    </div>
    <div class="main_right">
        <img src="../static/img/cj-2.png" class="main_title" />
        <div class="main_right_title">
            <span class="type"></span>
            <span class="num"><font></font>人</span>
        </div>
        <div class="list_box"> 
            <div class="list"></div>
            <div class="cj_box">
                <div class="cj_sroll">
                    <div class="cj_sroll_list "></div>
                    <p id="winner"></p>
                    <!-- <div class="cj_sroll_list cj_sroll_list2"></div> -->
                </div>
                <img src="../static/img/lhj.png" class="cj_img" />
            </div>
        </div> 
    </div>
</div>
 
<script>

    var list = [ {name:'幸运奖',img:'jpt.png'},{name:'三等奖',img:'jp3.png'},{name:'二等奖',img:'jp2.png'},{name:'一等奖',img:'jp1.png'}];
    var index = 0;
    var start = true;
    var times = 0; // 人数 
    var $uList = ""; 
    var timer = null;
    var timerhtml = null;
    var indexs = 1;
    var htmls = "";  
    var scrollHeight = 0;   
    var people_list = [];
    
    function getType(a){  
        getAll();
        $(".type").html(list[index].name);
        $(".list").html(""); 
        $(".num font").html(""); 
        $("#show").attr("src",'../static/img/' + list[index].img); 
    }

    function getLeft(){ 
        if(index == 0){
            index = list.length - 1;
        }else{
            index--; 
        }
        getType(1);
    }

    function getRight(){ 
        if(index == (list.length - 1)){
            index = 0;
        }else{
            index++; 
        }
        getType(2);
    }
 
    function cjDo(){  
        times = $("#num").val();
        console.log(times,$("#num").val());
        if(times && parseInt(times) >= 1){
            $(".num font").html(times);
            $("#start_bt").hide();
            $("#end_bt").show();
            getAll(); 
            setTimeout(getAlls,1000); 
            $("#winner").css("bottom",0);
        }else {
            alert("请输入大于1的数字");
        }  
    }


    function cjStop(){   
        $("#winner").stop().animate({
            bottom: 119
        }, 400,'linear');  
        getWinning(); 
        clearInterval(timer);  
    }
 
    function getWinning(){  
        $.ajax({
            url:"/lucky",
            success:function(res){
                html = '<div class="info1">'+ res.name +'（' + res.tel +'）</div>';
                $("#winner").html(res.tel);
                setTimeout(function () { getWinner(html); },500); 
            },
            error:function(){
                alert("暂无人员");
            },
        });
        
        
    }

    function getWinner(html){
        $(".list").append(html);
        $("#num").val($("#num").val() - 1);
        $("#end_bt").hide();
        $("#start_bt").show(); 
    }

    function getAlls(){  
        $uList = $(".cj_sroll_list"); 
        htmls = $(".cj_sroll_list").html();  
        scrollHeight = $(".cj_sroll_list p:first").height();    
        $(".cj_sroll_list").append(htmls);
        indexs = 1
        scrollList(indexs,scrollHeight);  
        indexs ++;
        timer = setInterval(function() {  
            scrollList(indexs,scrollHeight); 
            $(".cj_sroll_list").append(htmls); 
            indexs ++;
        }, 80 * people_list.length);
    }

 
    //滚动动画
    function scrollList(indexs,h,htmls) {   
        console.log(-h * indexs * people_list.length);
        $uList.stop().animate({
                marginTop: -h * indexs  * people_list.length
        }, 80 * people_list.length,'linear');  
    } 

    function getAll(){ 
        $.ajax({
            url:"/user",
            success:function(res){
                people_list =  res.data;
                var html_people = "";
                if(people_list && people_list.length > 0 ){ 
                    $(".cj_sroll_list").html(""); 
                    $(".cj_sroll_list").css("margin-top",0);
                    for (var i = 0; i < people_list.length; i++) {
                        html_people = '<p>'+ people_list[i].tel +'</p>';  
                        $(".cj_sroll_list").append(html_people); 
                    } 
                }
            },
            error:function(){
                alert("暂无人员");
            },
        });  
    }
 
    
    getType(0);
</script>

</body>
</html>